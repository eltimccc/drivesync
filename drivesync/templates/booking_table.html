{% extends 'base.html' %} {% block title %}Календарь бронирований{% endblock %}
{% block additional_styles %}
<style>
    .booking-status {
        cursor: pointer; /* Установка стиля указателя при наведении на элемент */
        transition: transform 0.3s; /* Добавление плавной анимации */
    }
    .booking-status:hover {
        text-decoration: underline; /* Добавление подчеркивания при наведении на элемент */
        transform: scale(1.1); /* Увеличение размера элемента на 10% */
    }

    .fixed-column,
    .fixed-month {
        position: sticky;
        left: 0;
        top: 0; /* Added to make the column sticky at the top */
        z-index: 1;
        background-color: #f8f9fa !important; /* Added !important to override other styles */
    }

    /* Минимальная высота для ячеек таблицы */
    .table-bordered th,
    .table-bordered td {
        min-height: 90px !important; /* Минимальная высота ячейки таблицы */
        border: 1px solid #dee2e6;
        padding: 8px;
        vertical-align: middle;
    }
    .fixed-height-cell {
        height: 70px; /* Задаем желаемую высоту */
    }
    .table-wrapper {
      overflow-y: scroll;
      max-height: 80vh; /* Опционально, чтобы не занимала весь экран */
    }


</style>
{% endblock %} {% block content %}
<div class="container">
  <button
    class="btn btn-success mt-3"
    data-bs-toggle="modal"
    data-bs-target="#addBookingModal"
  >
    Добавить бронь
  </button>
  <button
    class="btn btn-success mt-3"
    data-bs-toggle="modal"
    data-bs-target="#addCarModal"
  >
    Добавить машину
  </button>
  <button class="btn btn-info mt-3">
    <a href="/cars" style="color: white; text-decoration: none">Список машин</a>
  </button>

  <div
    class="modal fade"
    id="addBookingModal"
    tabindex="-1"
    aria-labelledby="addBookingModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="addCarModalLabel">
            Добавить бронирование
          </h4>
        </div>
        <div class="modal-body">
          <div id="addBookingModalContent"></div>
        </div>
      </div>
    </div>
  </div>
  <div
    class="modal fade"
    id="bookingModal"
    tabindex="-1"
    aria-labelledby="bookingModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <!-- Здесь будет загружено содержимое страницы бронирования -->
      </div>
    </div>
  </div>
  <div
    class="modal fade"
    id="addCarModal"
    tabindex="-1"
    aria-labelledby="addCarModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="addCarModalLabel">Добавить машину</h4>
        </div>
        <div class="modal-body">
          <div id="addCarModalContent"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="table-wrapper" id="table-wrapper">
    <table class="table table-striped">
    
      <thead>
        <tr>
          <th class="fixed-month" fixed-column rowspan="3" style="padding-bottom: 10px">
            Автомобили
          </th>
          <!-- Added rowspan attribute -->
          {% for month in months %}
          <th
            class="fixed-month"
            colspan="{{ month['days']|length }}"
            data-month-name="{{ month['name'] }}"
          >
            <h2>{{ month['name'] }}</h2>
          </th>
          {% endfor %}
        </tr>
        <tr>
          {% for _ in range(num_months) %} {% set weekdays = ["Пн", "Вт", "Ср",
          "Чт", "Пт", "Сб", "Вс"] %} {% for i in range(28) %}
          <th style="font-weight: normal; text-align: center; line-height: 0">
            {{ weekdays[i % 7] }}
          </th>
          {% endfor %} {% endfor %}
        </tr>
        <tr>
          {% for month in months %} {% for day in month['days'] %}
          <th style="font-weight: normal; text-align: center; line-height: 0">
            {{ day }}
          </th>
          {% endfor %} {% endfor %}
        </tr>
      </thead>
      <tbody id="table-body">
        {% for car in cars %}
        <tr>
          <td class="fixed-column">{{ car.brand }}</td>
          {% for month in months %} {% for day in month['days'] %}
          <td class="fixed-height-cell">
            {% for booking in car.bookings %} {% if booking.start_date.year ==
            month['year'] and booking.start_date.month == month['month'] and
            booking.start_date.day <= day <= booking.end_date.day %}
            <span
              class="badge booking-status"
              style="background-color: {{ booking_statuses_colors[booking.status] }};"
              data-booking-id="{{ booking.id }}"
              >{{ booking.status }}</span
            >
            {% endif %} {% endfor %}
          </td>
          {% endfor %} {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
  // Вызываем функцию при загрузке страницы и изменении размеров окна
  window.onload = function () {
    createEmptyCells();
    updateScrollbarPosition();
  };
  window.onresize = updateScrollbarPosition;
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Обработчик события клика на кнопке "Добавить бронь"
    $('button[data-bs-target="#addBookingModal"]').on("click", function () {
      $.ajax({
        url: "/add_booking",
        type: "GET",
        success: function (response) {
          $("#addBookingModalContent").html(response);
          $("#addBookingModal").modal("show");
        },
        error: function (xhr, status, error) {
          console.error("Error:", error);
          alert("An error occurred. Please try again.");
        },
      });
    });

    // Обработчик события клика на кнопке "Добавить машину"
    $('button[data-bs-target="#addCarModal"]').on("click", function () {
      $.ajax({
        url: "/add_car",
        type: "GET",
        success: function (response) {
          $("#addCarModalContent").html(response);
          $("#addCarModal").modal("show");
        },
        error: function (xhr, status, error) {
          console.error("Error:", error);
          alert("An error occurred. Please try again.");
        },
      });
    });
  });

  // Обработчик события нажатия на элемент статуса бронирования
  document
    .querySelectorAll(".booking-status")
    .forEach(function (bookingStatus) {
      bookingStatus.addEventListener("click", function () {
        var bookingId = this.getAttribute("data-booking-id");
        fetch("/booking/" + bookingId)
          .then((response) => response.text())
          .then((data) => {
            document
              .getElementById("bookingModal")
              .querySelector(".modal-content").innerHTML = data;
            $("#bookingModal").modal("show");
          })
          .catch((error) => console.error("Ошибка:", error));
      });
    });
</script>
{% endblock %}
